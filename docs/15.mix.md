```
Universidad del Quindío
Programa de Ingeniería de Sistemas y Computación
Programación III - Mix
Docente: Carlos Andrés Florez V.
```

# Mix


Mix es la herramienta oficial de construcción y gestión de proyectos para Elixir. Proporciona utilidades para desarrollo, compilación, pruebas y gestión de dependencias, facilitando la creación de aplicaciones robustas y mantenibles. Mix es el equivalente a herramientas como `npm` en JavaScript, `pip` en Python o `Maven` en Java, pero está específicamente diseñado para el ecosistema Elixir.

Los proyectos grandes que tienen varios archivos y módulos se benefician enormemente de Mix, ya que permite organizar el código, usar dependencias externas y automatizar tareas comunes. Además, los módulos se pueden comunicar entre sí, lo que facilita la creación de aplicaciones complejas.

## ¿Por qué usar Mix?

Usar Mix ofrece varias ventajas:

- **Organización del código**: Mix proporciona una estructura estándar para proyectos Elixir, lo que facilita la navegación, el mantenimiento del código y el trabajo en equipo.
- **Gestión de dependencias**: Mix facilita la inclusión y gestión de bibliotecas externas, lo que permite aprovechar el ecosistema de Elixir.
- **Automatización de tareas**: Mix permite definir y ejecutar tareas personalizadas, como compilación, pruebas y despliegue.
- **Integración con herramientas de Elixir**: Mix se integra perfectamente con otras herramientas del ecosistema Elixir, como ExUnit para pruebas y Hex para la gestión de paquetes.

Para más información, puede consultar la [documentación oficial de Mix](https://elixirschool.com/es/lessons/basics/mix).

## Estructura de un proyecto Mix

Un proyecto Mix típico tiene la siguiente estructura de directorios:

```
my_app/
├── _build/              # Archivos compilados (generado)
├── config/              # Archivos de configuración (opcional)
│   └── config.exs       # Archivo de configuración principal
├── lib/                 # Código fuente de la aplicación
│   └── my_app.ex        # Módulo principal
├── test/                # Pruebas unitarias
│   ├── test_helper.exs  # Configuración de pruebas
│   └── my_app_test.exs  # Pruebas del módulo principal
├── .gitignore           # Archivos ignorados por Git
├── mix.exs              # Archivo de configuración del proyecto
└── README.md            # Documentación del proyecto
``` 

La carpeta `lib` contiene el código fuente de la aplicación, aquí es donde se escriben los módulos y funciones de Elixir, es decir, la lógica de negocio del proyecto. 

## Comandos comunes de Mix

Con los siguientes comandos podemos gestionar y trabajar con proyectos Mix:

```bash
mix new my_app          # Crear un nuevo proyecto Mix
cd my_app
mix compile             # Compilar el proyecto
mix test                # Ejecutar pruebas
mix deps.get            # Obtener dependencias (descargarlas)
mix run                 # Ejecutar la aplicación
mix help                # Mostrar ayuda sobre comandos Mix
```

### Creación y compilación de un proyecto Mix

En su terminal, cree un nuevo proyecto Mix con `mix new my_app`, abra el proyecto en Visual Studio Code o su editor de texto preferido. Revise la estructura del proyecto.

## Archivo `mix.exs`

El archivo `mix.exs` es el archivo de configuración principal de un proyecto Mix. Aquí es donde se definen las dependencias, la versión del proyecto, el nombre del módulo principal, entre otros. Un ejemplo básico de un archivo `mix.exs` podría ser:

```elixir
defmodule MyApp.MixProject do
  use Mix.Project # Indica que este módulo es un proyecto Mix

  # Configuración del proyecto
  def project do 
    [
      app: :my_app,
      version: "0.1.0",
      elixir: "~> 1.18",
      start_permanent: Mix.env() == :prod,
      deps: deps()
    ]
  end

  # Configuración de la aplicación
  def application do
    [
        extra_applications: [:logger]
    ]
  end

  # Definición de dependencias externas
  defp deps do
    []
  end
end
```

En este ejemplo, se define el nombre del proyecto (`:my_app`), la versión (`"0.1.0"`), la versión de Elixir requerida (`"~> 1.18"`), y las dependencias (en este caso, ninguna). 

## Módulo principal y aplicaciones adicionales

Se recomienda usar el módulo `Application` para definir el punto de entrada de la aplicación. Para esto, debe modificar el archivo `lib/my_app.ex` para que se vea así:

```elixir
defmodule MyApp do
  use Application # Indica que este módulo es una aplicación OTP
    
    # Application necesita una función start/2. Esta función es el punto de entrada de la aplicación.
    def start(_type, _args) do
        IO.puts("Hello, Mix!")
        {:ok, self()}
    end
end
```

El modulo `Application` es parte de la OTP (Open Telecom Platform) y proporciona una forma estructurada de definir y gestionar aplicaciones Elixir. Al usar `use Application`, estamos indicando que este módulo es una aplicación OTP, lo que nos permite definir un punto de entrada para la aplicación a través de la función `start/2`. 

`Application` está pensado para aplicaciones que pueden tener procesos supervisados y otras características de OTP.

A su vez, en el archivo `mix.exs`, se debe especificar el módulo principal de la aplicación, que es el punto de entrada cuando se ejecuta la aplicación. Para esto, modifique la función `application` en `mix.exs` para que incluya el módulo principal:

```elixir
def application do
  [
    mod: {MyApp, []}, # Módulo principal de la aplicación
    extra_applications: [:logger]
  ]
end
```

La aplicación `:logger` es una biblioteca estándar de Elixir que proporciona funcionalidades de registro (logging) para aplicaciones Elixir. Al incluir `:logger` en la lista de `extra_applications`, estamos indicando que nuestra aplicación depende de esta biblioteca para manejar mensajes de registro, lo que es útil para monitorear y depurar la aplicación.

## Ejecución de la aplicación

Ubique el directorio del proyecto y compilelo con:

```bash
mix compile
```

Luego, ejecute la aplicación con:

```bash
mix run
``` 

Debería ver el mensaje `Hello, Mix!` en la consola.

## Creación de pruebas 

Mix facilita la creación y ejecución de pruebas. Los archivos de prueba se colocan en el directorio `test`. Cree un archivo de prueba llamado `my_app_test.exs` en el directorio `test` con el siguiente contenido:

```elixir
defmodule MyAppTest do
  use ExUnit.Case # Importa las funcionalidades de ExUnit para pruebas

  test "la suma funciona correctamente" do
    assert 1 + 1 == 2
  end

  test "la resta funciona correctamente" do
    assert 2 - 1 == 1
  end

  test "la multiplicación no da un resultado incorrecto" do
    refute 2 * 3 == 7
  end

end
```

Esta prueba verifica varias operaciones aritméticas, lo cual es una prueba simple pero efectiva para demostrar cómo funcionan las pruebas en Elixir.

Toda prueba en Elixir se define dentro de un módulo que utiliza `ExUnit.Case`, lo que proporciona las herramientas necesarias para escribir y ejecutar pruebas. La función `test` define una prueba individual, y dentro de ella se utilizan aserciones como `assert` o `refute` para verificar condiciones.

Para ejecutar las pruebas, use el comando:

```bash
mix test
```

Debería salir un resumen de las pruebas ejecutadas, indicando cuántas pasaron y cuántas fallaron.

---

## Ejercicios

### Ejercicio 1

Cree un nuevo proyecto Mix llamado `gimnasio` e integre todo lo que hicimos previamente en el proyecto que era sobre el CRUD de socios y sus clases. Asegúrese de que el proyecto compile y se ejecute correctamente. Además, agregue al menos dos pruebas unitarias para verificar el correcto funcionamiento de las funciones CRUD.

Estructura sugerida del proyecto:

```
gimnasio/
├── lib/
│   ├── gimnasio.ex           # Módulo principal
│   ├── gimnasio/
│   │   ├── socio.ex          # Gestión de socios
│   │   ├── clase.ex          # Gestión de clases
│   │   └── registro.ex       # Registro de asistencias
└── test/
    ├── gimnasio_test.exs
    └── gimnasio/
        ├── socio_test.exs
        ├── clase_test.exs
        └── registro_test.exs
```

---

### Ejercicio 2

Convierta el sistema de gestión de tareas de la guía anterior en una aplicación OTP completa utilizando Mix. Cree un proyecto Mix, defina un árbol de supervisión para el servidor de tareas y asegúrese de que el servidor se inicie automáticamente cuando se inicie la aplicación.

Estructura sugerida del proyecto:

```
tareas_app/
├── lib/
│   ├── tareas_app.ex                # Application
│   └── tareas_app/
│       ├── servidor_tareas.ex       # GenServer
│       └── supervisor.ex            # Supervisor
└── test/
    └── tareas_app/
        └── servidor_tareas_test.exs
```

---

## Para la próxima clase

- Cuáles son las dependencias más comunes en proyectos Elixir y para qué se usan.
- Investigue qué es **Phoenix** y cómo se relaciona con Elixir y Mix.
